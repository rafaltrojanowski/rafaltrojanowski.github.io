<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>How to build Nested Form ala Rails with Phoenix Liveview · Rafal Trojanowski - Ruby on Rails Developer</title><meta name="description" content="I'm remote Ruby on Rails Developer based in Poland"><meta name="og:title" content="How to build Nested Form ala Rails with Phoenix Liveview"><meta name="og:type" content="website"><meta name="og:url" content="http://rafaltrojanowski.github.io/2021/01/09/how-to-build-nested-form-ala-rails-with-phoenix-liveview/"><meta name="og:image" content="http://image.toast.com/aaaaahq/hola_cover.JPG"><meta name="og:description" content="I'm remote Ruby on Rails Developer based in Poland"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/chiangmai.css"><meta name="steem:author" content="@stunstunstun"><meta name="fb:app_id" content="1279423065775877"><link rel="search" type="application/opensearchdescription+xml" href="http://rafaltrojanowski.github.io/atom.xml" title="Rafal Trojanowski - Ruby on Rails Developer"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Rafal Trojanowski - Ruby on Rails Developer" type="application/atom+xml">
</head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">How to build Nested Form ala Rails with Phoenix Liveview</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/rafaltrojanowski" target="_blank"><img src="/image/rt-avatar.jpg"></a></div><div class="post-info-details"><div class="post-categories"></div><div class="post-date">Jan 9, 2021</div></div></div><div class="post-share"><div class="fb-like" data-href="http://rafaltrojanowski.github.io/2021/01/09/how-to-build-nested-form-ala-rails-with-phoenix-liveview/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="http://rafaltrojanowski.github.io/2021/01/09/how-to-build-nested-form-ala-rails-with-phoenix-liveview/" data-layout="button" data-size="small" data-mobile-iframe="true"></div><div class="fb-follow" data-href="https://www.facebook.com/rafalltrojanowski" data-layout="button_count" data-size="small" data-show-faces="true"></div></div><div class="post-content"><p>Every pricing plan needs to list of features. To allow users to type all related data in one form we want to implement something that is called “Nested form” and is well known from other Web Frameworks - Ruby on Rails, thanks to a dedicated gem that handles it out of the box. Some community members considered this as an anti-pattern, however from<br>the user experience perspective it saves a lot of time when adding data to the tables that have one-to-many relationships.</p>
<p>There are a few ways to achieve it with Elixir, after analyzing all of them the most efficient and the most Phonix-way in my opinion is the one that uses LiveView, one of the flag features of Web Framework that is getting more traction.</p>
<p>To achieve my goal with Phoenix it took me a bit of time, so I decided to describe the process of adding this feature to my SaaS app.</p>
<h2>Setup of Phoenix LiveView</h2>

<p>Surprisingly to me, not every Phoenix app is ready to play with LiveView. You can add a flag during project generation or setup it manually. I used the second approach and the whole process is not complicated. You can find an installation guide here: <a href="https://hexdocs.pm/phoenix_live_view/installation.html" target="_blank" rel="noopener">https://hexdocs.pm/phoenix_live_view/installation.html</a></p>
<p>After setting up a live view let’s add our features to the schema of a pricing plan:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="class"><span class="keyword">defmodule</span> <span class="title">Kickstart.Accounts.PricingPlan</span></span> <span class="keyword">do</span></span><br><span class="line">    schema <span class="string">"pricing_plans"</span> <span class="keyword">do</span></span><br><span class="line">      field <span class="symbol">:description</span>, <span class="symbol">:string</span></span><br><span class="line">      field <span class="symbol">:name</span>, <span class="symbol">:string</span></span><br><span class="line">      field <span class="symbol">:position</span>, <span class="symbol">:integer</span></span><br><span class="line">      field <span class="symbol">:is_visible</span>, <span class="symbol">:boolean</span></span><br><span class="line"></span><br><span class="line">+     embeds_many <span class="symbol">:features</span>, Feature, <span class="symbol">on_replace:</span> <span class="symbol">:delete</span> <span class="comment"># add this line</span></span><br><span class="line">      timestamps()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Modify pricing plan changeset in the same file, by adding cast_embed function that does the job:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">changeset</span></span>(pricing_plan, attrs) <span class="keyword">do</span></span><br><span class="line">    pricing_plan</span><br><span class="line">    |&gt; cast(attrs, [<span class="symbol">:name</span>, <span class="symbol">:price</span>, <span class="symbol">:period</span>, <span class="symbol">:description</span>, <span class="symbol">:position</span>, <span class="symbol">:is_visible</span>])</span><br><span class="line">    |&gt; validate_required([<span class="symbol">:name</span>, <span class="symbol">:price</span>, <span class="symbol">:period</span>, <span class="symbol">:description</span>, <span class="symbol">:position</span>])</span><br><span class="line">    |&gt; validate_length(<span class="symbol">:description</span>, <span class="symbol">min:</span> <span class="number">5</span>)</span><br><span class="line">    |&gt; validate_number(<span class="symbol">:price</span>, <span class="symbol">greater_than:</span> 0)</span><br><span class="line">+   |&gt; cast_embed(<span class="symbol">:features</span>, <span class="symbol">with:</span> &amp;Kickstart.Accounts.Feature.changeset/<span class="number">2</span>, <span class="symbol">required:</span> <span class="keyword">true</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>and add Feature model:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Kickstart.Accounts.Feature</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Schema</span><br><span class="line">  <span class="keyword">import</span> Ecto.Changeset</span><br><span class="line"></span><br><span class="line">  embedded_schema <span class="keyword">do</span></span><br><span class="line">    field <span class="symbol">:title</span></span><br><span class="line">    field <span class="symbol">:temp_id</span>, <span class="symbol">:string</span>, <span class="symbol">virtual:</span> <span class="keyword">true</span></span><br><span class="line">    field <span class="symbol">:delete</span>, <span class="symbol">:boolean</span>, <span class="symbol">virtual:</span> <span class="keyword">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">changeset</span></span>(feature, attrs) <span class="keyword">do</span></span><br><span class="line">    feature</span><br><span class="line">    |&gt; Map.put(<span class="symbol">:temp_id</span>, (feature.temp_id || attrs[<span class="string">"temp_id"</span>])) <span class="comment"># So its persisted</span></span><br><span class="line">    |&gt; cast(attrs, [<span class="symbol">:title</span>, <span class="symbol">:delete</span>]) <span class="comment"># Add delete here</span></span><br><span class="line">    |&gt; validate_required([<span class="symbol">:title</span>])</span><br><span class="line">    |&gt; maybe_mark_for_deletion()</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">maybe_mark_for_deletion</span></span>(%&#123;<span class="symbol">data:</span> %&#123;<span class="symbol">id:</span> <span class="keyword">nil</span>&#125;&#125; = changeset), <span class="symbol">do:</span> changeset</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">maybe_mark_for_deletion</span></span>(changeset) <span class="keyword">do</span></span><br><span class="line">    if get_change(changeset, <span class="symbol">:delete</span>) <span class="keyword">do</span></span><br><span class="line">      %&#123;changeset | <span class="symbol">action:</span> <span class="symbol">:delete</span>&#125;</span><br><span class="line">    else</span><br><span class="line">      changeset</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>We also need to add a small module that will be used later in our live form:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Kickstart.PricingPlans</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">alias</span> Kickstart.Accounts.Feature</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change_feature</span></span>(%Feature&#123;&#125; = feature) <span class="keyword">do</span></span><br><span class="line">    Feature.changeset(feature, %&#123;&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>And finally, implement our live form:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">KickstartWeb.PricingPlanFormLive</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Phoenix.LiveView</span><br><span class="line"></span><br><span class="line">  <span class="keyword">alias</span> Kickstart.Accounts</span><br><span class="line">  <span class="keyword">alias</span> Kickstart.PricingPlans</span><br><span class="line">  <span class="keyword">alias</span> Kickstart.Accounts.PricingPlan</span><br><span class="line">  <span class="keyword">alias</span> Kickstart.Accounts.Feature</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">mount</span></span>(_params, %&#123;<span class="string">"action"</span> =&gt; action, <span class="string">"csrf_token"</span> =&gt; csrf_token&#125; = session, socket) <span class="keyword">do</span></span><br><span class="line">    pricing_plan = get_pricing_plan(session)</span><br><span class="line">    changeset =</span><br><span class="line">      Accounts.change_pricing_plan(pricing_plan)</span><br><span class="line">      |&gt; Ecto.Changeset.put_embed(<span class="symbol">:features</span>, pricing_plan.features)</span><br><span class="line"></span><br><span class="line">    assigns = [</span><br><span class="line">      <span class="symbol">conn:</span> socket,</span><br><span class="line">      <span class="symbol">action:</span> action,</span><br><span class="line">      <span class="symbol">csrf_token:</span> csrf_token,</span><br><span class="line">      <span class="symbol">changeset:</span> changeset,</span><br><span class="line">      <span class="symbol">pricing_plan:</span> pricing_plan</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, assign(socket, assigns)&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">render</span></span>(assigns) <span class="keyword">do</span></span><br><span class="line">    KickstartWeb.Admin.PricingPlanView.render(<span class="string">"form.html"</span>, assigns)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_event</span></span>(<span class="string">"add-feature"</span>, _, socket) <span class="keyword">do</span></span><br><span class="line">    vars = Map.get(socket.assigns.changeset.changes, <span class="symbol">:features</span>, socket.assigns.pricing_plan.features)</span><br><span class="line"></span><br><span class="line">    features =</span><br><span class="line">      vars</span><br><span class="line">      |&gt; Enum.concat([</span><br><span class="line">        PricingPlans.change_feature(%Feature&#123;<span class="symbol">temp_id:</span> get_temp_id()&#125;)</span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    changeset =</span><br><span class="line">      socket.assigns.changeset</span><br><span class="line">      |&gt; Ecto.Changeset.put_embed(<span class="symbol">:features</span>, features)</span><br><span class="line"></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, assign(socket, <span class="symbol">changeset:</span> changeset)&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_event</span></span>(<span class="string">"remove-feature"</span>, %&#123;<span class="string">"remove"</span> =&gt; remove_id&#125;, socket) <span class="keyword">do</span></span><br><span class="line">    features =</span><br><span class="line">      socket.assigns.changeset.changes.features</span><br><span class="line">      |&gt; Enum.reject(<span class="keyword">fn</span> %&#123;<span class="symbol">data:</span> feature&#125; -&gt;</span><br><span class="line">        feature.temp_id == remove_id</span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">    changeset =</span><br><span class="line">      socket.assigns.changeset</span><br><span class="line">      |&gt; Ecto.Changeset.put_embed(<span class="symbol">:features</span>, features)</span><br><span class="line"></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, assign(socket, <span class="symbol">changeset:</span> changeset)&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_pricing_plan</span></span>(%&#123;<span class="string">"id"</span> =&gt; id&#125; = _pricing_plan_params), <span class="symbol">do:</span> Accounts.get_pricing_plan!(id)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_pricing_plan</span></span>(_pricing_plan_params), <span class="symbol">do:</span> %PricingPlan&#123;<span class="symbol">features:</span> []&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">get_temp_id</span></span>, <span class="symbol">do:</span> <span class="symbol">:crypto</span>.strong_rand_bytes(<span class="number">5</span>) |&gt; Base.url_encode64 |&gt; binary_part(0, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Update our edit and new templates (new will be similar - just remove an id from the session):</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">"torch-header-and-content"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"torch-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Edit Pricing plan<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%=</span> <span class="attr">live_render</span> @<span class="attr">conn</span>, <span class="attr">KickstartWeb.PricingPlanFormLive</span>,</span></span><br><span class="line"><span class="tag">      <span class="attr">session:</span> %&#123;</span></span><br><span class="line"><span class="tag">        "<span class="attr">id</span>" =&gt;</span> @pricing_plan.id,</span><br><span class="line">        "action" =&gt; Routes.admin_pricing_plan_path(@conn, :update, @pricing_plan),</span><br><span class="line">        "csrf_token" =&gt; Plug.CSRFProtection.get_csrf_token()</span><br><span class="line">       &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>And this is our form with nested inputs (please remember to change the extension to .leex):j</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">form_for</span> @<span class="attr">changeset</span>, @<span class="attr">action</span>, [<span class="attr">multipart:</span> <span class="attr">true</span>, <span class="attr">csrf_token:</span> @<span class="attr">csrf_token</span>], <span class="attr">fn</span> <span class="attr">f</span> <span class="attr">-</span>&gt;</span> %&gt;</span><br><span class="line"></span><br><span class="line">  (... list of inputs ... )</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>Features<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">%=</span> <span class="attr">inputs_for</span> <span class="attr">f</span>, <span class="attr">:features</span>, <span class="attr">fn</span> <span class="attr">v</span> <span class="attr">-</span>&gt;</span> %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"flex flex-wrap -mx-1 overflow-hidden"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"torch-form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%=</span> <span class="attr">label</span> <span class="attr">v</span>, <span class="attr">:title</span>%&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%=</span> <span class="attr">text_input</span> <span class="attr">v</span>, <span class="attr">:title</span>, <span class="attr">class:</span> "<span class="attr">form-control</span>" %&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%=</span> <span class="attr">error_tag</span> <span class="attr">v</span>, <span class="attr">:title</span> %&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"torch-form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%=</span> <span class="attr">label</span> <span class="attr">v</span>, <span class="attr">:delete</span> %&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%=</span> <span class="attr">if</span> <span class="attr">is_nil</span>(<span class="attr">v.data.temp_id</span>) <span class="attr">do</span> %&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">%=</span> <span class="attr">checkbox</span> <span class="attr">v</span>, <span class="attr">:delete</span> %&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span> <span class="attr">else</span> %&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">%=</span> <span class="attr">hidden_input</span> <span class="attr">v</span>, <span class="attr">:temp_id</span> %&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">phx-click</span>=<span class="string">"remove-feature"</span> <span class="attr">phx-value-remove</span>=<span class="string">"&lt;%= v.data.temp_id %&gt;"</span>&gt;</span>&amp;times<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span> <span class="attr">end</span> %&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">%</span> <span class="attr">end</span> %&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">phx-click</span>=<span class="string">"add-feature"</span>&gt;</span>Add feature<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  (... submit button ... )</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">end</span> %&gt;</span></span><br></pre></td></tr></table></figure>

<h2>Summary</h2>

<p>I got stuck for a while when working on this feature because my initial implementation used mount/2 instead of mount/3. Apart from this implementing this with the live view was quite enjoyable and I’m very happy with the final result.<br>Here you can see how it works:<br><img src="nested-form.gif" alt=""></p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2020/12/02/vscode-code-snippets/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="next" href="/2024/04/04/full-text-search-with-elasticsearch-in-rails/"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></div><div class="fb-comments-area"><div class="fb-comments" data-href="http://rafaltrojanowski.github.io/2021/01/09/how-to-build-nested-form-ala-rails-with-phoenix-liveview/" data-width="700" data-numposts="5"></div></div><div class="copyright"><p>© 2012 - 2024 <a href="https://github.com/stunstunstun" target="_blank">Rafał Trojanowski</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div><script>window.fbAsyncInit=function(){FB.init({appId:"1279423065775877",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-112438069-1','auto');ga('send','pageview');</script></body></html>