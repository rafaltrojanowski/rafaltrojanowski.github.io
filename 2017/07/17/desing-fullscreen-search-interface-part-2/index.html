<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Desing Fullscreen Search Interface With Ember - Part 2 · Rafal Trojanowski - Ruby on Rails Developer</title><meta name="description" content="I'm remote Ruby on Rails Developer based in Poland"><meta name="og:title" content="Desing Fullscreen Search Interface With Ember - Part 2"><meta name="og:type" content="website"><meta name="og:url" content="http://rafaltrojanowski.github.io/2017/07/17/desing-fullscreen-search-interface-part-2/"><meta name="og:image" content="http://image.toast.com/aaaaahq/hola_cover.JPG"><meta name="og:description" content="I'm remote Ruby on Rails Developer based in Poland"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/chiangmai.css"><meta name="steem:author" content="@stunstunstun"><link rel="search" type="application/opensearchdescription+xml" href="http://rafaltrojanowski.github.io/atom.xml" title="Rafal Trojanowski - Ruby on Rails Developer"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Rafal Trojanowski - Ruby on Rails Developer" type="application/atom+xml">
</head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">Desing Fullscreen Search Interface With Ember - Part 2</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/rafaltrojanowski" target="_blank"><img src="/image/rt-avatar.jpeg"></a></div><div class="post-info-details"><div class="post-categories"></div><div class="post-date">Jul 17, 2017</div></div></div><div class="post-share"><div class="fb-like" data-href="http://rafaltrojanowski.github.io/2017/07/17/desing-fullscreen-search-interface-part-2/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="http://rafaltrojanowski.github.io/2017/07/17/desing-fullscreen-search-interface-part-2/" data-layout="button" data-size="small" data-mobile-iframe="true"></div></div><div class="post-content"><p>In the first part we prepared a routable modal for the search interface.<br>Now it’s time to allow a user to interact with that modal and query backend.</p>
<h2 id="Add-search-form-component"><a href="#Add-search-form-component" class="headerlink" title="Add search form component"></a>Add search form component</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ember generate component search-form</span><br></pre></td></tr></table></figure>

<p><code>app/components/search-form.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Ember <span class="keyword">from</span> <span class="string">'ember'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Ember.Component.extend(&#123;&#125;);</span><br></pre></td></tr></table></figure>

<p><code>app/templates/components/search-form.hbs</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>What are you searching for?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>app/templates/search.hbs</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;#full-screen-modal-dialog&#125;&#125;</span><br><span class="line">  &#123;&#123;search-box&#125;&#125;</span><br><span class="line">&#123;&#123;/full-screen-modal-dialog&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>tests/integration/components/search-box-test.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; test, moduleForComponent &#125; <span class="keyword">from</span> <span class="string">'ember-qunit'</span>;</span><br><span class="line"><span class="keyword">import</span> hbs <span class="keyword">from</span> <span class="string">'htmlbars-inline-precompile'</span>;</span><br><span class="line"></span><br><span class="line">moduleForComponent(<span class="string">'search-box'</span>, <span class="string">'Integration | Component | search box'</span>, &#123;</span><br><span class="line">  integration: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">test(<span class="string">'it renders'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">assert</span>) </span>&#123;</span><br><span class="line">  assert.expect(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.render(hbs <span class="string">`&#123;&#123;search-box&#125;&#125;`</span>);</span><br><span class="line"></span><br><span class="line">  assert.equal(<span class="keyword">this</span>.$(<span class="string">'h1'</span>).text().trim(), <span class="string">'Hello!'</span>);</span><br><span class="line">  assert.equal(<span class="keyword">this</span>.$(<span class="string">'p:first'</span>).text().trim(), <span class="string">"What are you searching for?"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Now it’s time to make this component able to act.<br>We add an acceptance test first as it’s very easy to describe what we want to achieve.</p>
<p><code>tests/acceptance/search-test.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'search by query'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">assert</span>) </span>&#123;</span><br><span class="line">  visit(<span class="string">'/search'</span>);</span><br><span class="line"></span><br><span class="line">  fillIn(<span class="string">'input.search-query'</span>, <span class="string">'watermelon'</span>);</span><br><span class="line">  click(<span class="string">'input.submit-button'</span>);</span><br><span class="line"></span><br><span class="line">  andThen(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    assert.equal(currentURL(), <span class="string">'/search?query=watermelon'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>app/components/search-box.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Ember <span class="keyword">from</span> <span class="string">'ember'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Ember.Component.extend(&#123;</span><br><span class="line">  query: <span class="string">""</span>,</span><br><span class="line"></span><br><span class="line">  actions: &#123;</span><br><span class="line">    updateParams() &#123;</span><br><span class="line">      <span class="keyword">this</span>.sendAction(<span class="string">'updateParams'</span>) <span class="comment">// or this.attrs.updateParams();</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>app/controllers/search.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Ember <span class="keyword">from</span> <span class="string">'ember'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Ember.Controller.extend(&#123;</span><br><span class="line">  queryParams: [<span class="string">'query'</span>],</span><br><span class="line">  query: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  actions: &#123;</span><br><span class="line">    updateParams() &#123;</span><br><span class="line">      <span class="keyword">this</span>.transitionToRoute(<span class="string">'search'</span>, &#123; <span class="attr">queryParams</span>: &#123; <span class="attr">query</span>: @<span class="keyword">get</span>('query') &#125;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>And finally:</p>
<p><code>app/templates/components/search-box.hbs</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>What are you searching for?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span> &#123;&#123;<span class="attr">action</span> "<span class="attr">updateParams</span>" <span class="attr">on</span>=<span class="string">"submit"</span>&#125;&#125;&gt;</span></span><br><span class="line">  &#123;&#123;input class="search-query" value=query&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"submit-button"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>app/templates/search.hbs</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;#modal-dialog&#125;&#125;</span><br><span class="line">  &#123;&#123;search-box updateParams=(action "updateParams") query=query&#125;&#125;</span><br><span class="line">&#123;&#123;/modal-dialog&#125;&#125;</span><br></pre></td></tr></table></figure>


<p>On the end action can be tested in component integration test this way:</p>
<p><code>tests/integration/components/search-box-test.coffee</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'when clicks on submit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">assert</span>) </span>&#123;</span><br><span class="line">  assert.expect(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.set(<span class="string">'query'</span>, <span class="string">"watermelon"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.set(<span class="string">'updateParams'</span>, () =&gt; &#123;</span><br><span class="line">    assert.ok(<span class="literal">true</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.render(hbs <span class="string">`&#123;&#123;search-box query=query updateParams=(action updateParams)&#125;&#125;`</span>);</span><br><span class="line">  <span class="keyword">this</span>.$(<span class="string">'input.submit-button'</span>).click();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>So now we have a component that can communicate and pass a query to the router. But there is one bummer! When user types, URL changes instantly. We don’t want to send a query to the backend on each key down event though, so let’s fix it:</p>
<p>Let’s rename the component property, and thanks to this propagate property changes only after submitting our form:</p>
<p><code>tests/acceptance/search-test.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'search by query do not modify url without submit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">assert</span>) </span>&#123;</span><br><span class="line">  visit(<span class="string">'/search'</span>);</span><br><span class="line"></span><br><span class="line">  fillIn(<span class="string">'input.search-query'</span>, <span class="string">'wate'</span>);</span><br><span class="line"></span><br><span class="line">  andThen(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    assert.equal(currentURL(), <span class="string">'/search'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>app/components/search-box.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Ember.Component.extend(&#123;</span><br><span class="line">  searchQuery: <span class="string">""</span>,</span><br><span class="line"></span><br><span class="line">  actions: &#123;</span><br><span class="line">    updateParams() &#123;</span><br><span class="line">      <span class="keyword">this</span>.set(<span class="string">'query'</span>, <span class="keyword">this</span>.get(<span class="string">'searchQuery'</span>)); <span class="comment">// that's the trick!</span></span><br><span class="line">      <span class="keyword">this</span>.sendAction(<span class="string">'updateParams'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>app/templates/components/search-box.hbs</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span> &#123;&#123;<span class="attr">action</span> "<span class="attr">updateParams</span>" <span class="attr">on</span>=<span class="string">"submit"</span>&#125;&#125;&gt;</span></span><br><span class="line">  &#123;&#123;input class="search-query" value=searchQuery&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"submit-button"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Add-querying-mechanism"><a href="#Add-querying-mechanism" class="headerlink" title="Add querying mechanism"></a>Add querying mechanism</h2><p>That part is pretty simple, it’s just passing data down to the component from model hook:</p>
<p><code>app/routes/search.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Ember <span class="keyword">from</span> <span class="string">'ember'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Ember.Route.extend(&#123;</span><br><span class="line">  queryParams: &#123;</span><br><span class="line">    query: &#123;</span><br><span class="line">      refreshModel: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  model(params) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.store.query(<span class="string">'note'</span>, &#123; <span class="attr">title</span>: params.query &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>I will skip the rest of the code, now let’s focus on:</p>
<h2 id="Mocking-backend"><a href="#Mocking-backend" class="headerlink" title="Mocking backend"></a>Mocking backend</h2><p>I know two reasonable approaches. Okay, technically there are three:</p>
<ol>
<li>hard-coded array of JavaScript objects in route`s model hook</li>
<li>http-mock <a href="https://ember-cli.com/user-guide/#mocks-and-fixtures" target="_blank" rel="noopener">https://ember-cli.com/user-guide/#mocks-and-fixtures</a> (check this out too: <a href="https://www.npmjs.com/package/ember-cli-testem-http-mocks" target="_blank" rel="noopener">https://www.npmjs.com/package/ember-cli-testem-http-mocks</a>)</li>
<li>using client-side mock server ember-cli-mirage (<a href="http://www.ember-cli-mirage.com/" target="_blank" rel="noopener">http://www.ember-cli-mirage.com/</a>)</li>
</ol>
<p>As the last one have a great opinion in the community we will choose it.<br>By the way, it could be used both for development and tests by default, while http-mock requires an additional addon to make it work in the test environment.</p>
<p>Our updated <code>tests/acceptance/search-test.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'queries notes by title'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">assert</span>) </span>&#123;</span><br><span class="line">  server.createList(<span class="string">'note'</span>, <span class="number">10</span>) <span class="comment">// create records with mirage</span></span><br><span class="line">  visit(<span class="string">'/search'</span>);</span><br><span class="line"></span><br><span class="line">  fillIn(<span class="string">'input.search-query'</span>, <span class="string">'Note#5'</span>);</span><br><span class="line">  click(<span class="string">'input.submit-button'</span>);</span><br><span class="line"></span><br><span class="line">  andThen(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    assert.equal(find(<span class="string">'ul.notes li'</span>).length, <span class="number">1</span>);</span><br><span class="line">    assert.equal(find(<span class="string">'ul.notes li:first'</span>).text(), <span class="string">"Note#5"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Now time to make the test pass!</p>
<p>Mirage provides powerful stuff, for example, database methods known from Rails world, for example:<br><code>http://www.ember-cli-mirage.com/docs/v0.3.x/database/#where</code><br>It will be really useful in our search feature!<br>By the way, I just found that it could be used to do super spicy things, check<br><a href="https://github.com/samselikoff/ember-cli-mirage/pull/379" target="_blank" rel="noopener">https://github.com/samselikoff/ember-cli-mirage/pull/379</a> for details.</p>
<p>Let’s dive into code:</p>
<p><code>mirage/factories/note.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Factory &#125; <span class="keyword">from</span> <span class="string">'ember-cli-mirage'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Factory.extend(&#123;</span><br><span class="line">  title(i) &#123; <span class="keyword">return</span> <span class="string">'Note#'</span> + i; &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>mirage/config.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.namespace = <span class="string">'/api'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.get(<span class="string">'/notes/'</span>, (schema, request) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(request.queryParams.title === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> schema.notes.all();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> schema.notes.where(&#123;<span class="attr">title</span>: request.queryParams.title&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Improvements"><a href="#Improvements" class="headerlink" title="Improvements"></a>Improvements</h2><h3 id="Speed-up-rendering-the-modal"><a href="#Speed-up-rendering-the-modal" class="headerlink" title="Speed up rendering the modal"></a>Speed up rendering the modal</h3><p>There is also one thing that is not so good. Fetching all data in the model hook blocks the transition. So if there are no Notes in Ember store yet, it could take some time to show a modal filled with data. We want to show a modal smoothly.</p>
<p>This video (<a href="https://www.youtube.com/watch?v=kPxiiAGMSzE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=kPxiiAGMSzE</a>) from EmberConf 2017 was an inspiration on how to solve this problem elegantly.<br>Check this out:</p>
<p><code>app/routes/search.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Ember <span class="keyword">from</span> <span class="string">'ember'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Ember.Route.extend(&#123;</span><br><span class="line"></span><br><span class="line">  model() &#123;</span><br><span class="line">    Ember.run.schedule(<span class="string">'afterRender'</span>, <span class="keyword">this</span>, <span class="keyword">this</span>._fetchNotes);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  _fetchNotes() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; controller, store &#125; = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">let</span> &#123; query &#125; = controller;</span><br><span class="line"></span><br><span class="line">    controller.set(<span class="string">'isLoading'</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (query) &#123;</span><br><span class="line">      store.query(<span class="string">'note'</span>, &#123; <span class="attr">title</span>: query &#125;)</span><br><span class="line">        .then(<span class="keyword">this</span>._loadNotes.bind(<span class="keyword">this</span>))</span><br><span class="line">        .finally(<span class="keyword">this</span>._done.bind(<span class="keyword">this</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      store.findAll(<span class="string">'note'</span>, &#123; <span class="attr">reload</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        .then(<span class="keyword">this</span>._loadNotes.bind(<span class="keyword">this</span>))</span><br><span class="line">        .finally(<span class="keyword">this</span>._done.bind(<span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  _loadNotes(notes) &#123;</span><br><span class="line">    <span class="keyword">this</span>.controller.set(<span class="string">'model'</span>, notes);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  _done() &#123;</span><br><span class="line">    <span class="keyword">this</span>.controller.set(<span class="string">'isLoading'</span>, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The thing is that we schedule fetching the notes after rendering a template:<br>(BTW loading text could be replaced with any nice spinner instead)</p>
<p><img src="/images/search-part-2.gif" alt=""></p>
<p>As you can see even if a long list of notes is fetched, a modal dialog is opened immediately. That was not possible with the previous solution.</p>
<h3 id="Add-close-button-to-back-to-home-page"><a href="#Add-close-button-to-back-to-home-page" class="headerlink" title="Add close button to back to home page"></a>Add close button to back to home page</h3><p><code>tests/acceptance/search-test.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'close search modal'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">assert</span>) </span>&#123;</span><br><span class="line">  visit(<span class="string">'/search'</span>);</span><br><span class="line"></span><br><span class="line">  click(<span class="string">'a.search-close'</span>);</span><br><span class="line"></span><br><span class="line">  andThen(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    assert.equal(currentURL(), <span class="string">'/'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>app/templates/search.hbs</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;#full-screen-modal-dialog&#125;&#125;</span><br><span class="line">  &#123;&#123;#link-to "application" class='search-close'&#125;&#125;Close&#123;&#123;/link-to&#125;&#125;</span><br><span class="line">  (...)</span><br><span class="line">&#123;&#123;/full-screen-modal-dialog&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>Simple, right?</p>
<p>Thanks for reading!</p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2017/07/17/desing-fullscreen-search-interface/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="next" href="/2017/07/19/desing-fullscreen-search-interface-part-3/"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></div><div class="copyright"><p>© 2012 - 2024 <a href="https://github.com/stunstunstun" target="_blank">Rafał Trojanowski</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-112438069-1','auto');ga('send','pageview');</script></body></html>