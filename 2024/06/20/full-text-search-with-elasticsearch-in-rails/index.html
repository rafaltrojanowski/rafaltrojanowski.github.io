<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Getting started with Full-text Search with Elasticsearch in Rails · Rafal Trojanowski - Ruby on Rails Developer</title><meta name="description" content="I'm remote Ruby on Rails Developer based in Poland"><meta name="og:title" content="Getting started with Full-text Search with Elasticsearch in Rails"><meta name="og:type" content="website"><meta name="og:url" content="http://rafaltrojanowski.github.io/2024/06/20/full-text-search-with-elasticsearch-in-rails/"><meta name="og:image" content="http://image.toast.com/aaaaahq/hola_cover.JPG"><meta name="og:description" content="I'm remote Ruby on Rails Developer based in Poland"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/chiangmai.css"><meta name="steem:author" content="@stunstunstun"><meta name="fb:app_id" content="1279423065775877"><link rel="search" type="application/opensearchdescription+xml" href="http://rafaltrojanowski.github.io/atom.xml" title="Rafal Trojanowski - Ruby on Rails Developer"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Rafal Trojanowski - Ruby on Rails Developer" type="application/atom+xml">
</head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">Getting started with Full-text Search with Elasticsearch in Rails</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/rafaltrojanowski" target="_blank"><img src="/image/rt-avatar.jpg"></a></div><div class="post-info-details"><div class="post-categories"></div><div class="post-date">Jun 20, 2024</div></div></div><div class="post-share"><div class="fb-like" data-href="http://rafaltrojanowski.github.io/2024/06/20/full-text-search-with-elasticsearch-in-rails/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="http://rafaltrojanowski.github.io/2024/06/20/full-text-search-with-elasticsearch-in-rails/" data-layout="button" data-size="small" data-mobile-iframe="true"></div><div class="fb-follow" data-href="https://www.facebook.com/rafalltrojanowski" data-layout="button_count" data-size="small" data-show-faces="true"></div></div><div class="post-content"><h1>What is Elasticsearch</h1>

<p>Elasticsearch is a distributed, open source NoSQL database built with Java. This means that it stores data in a way that you cannot use SQL to query it. Elasticsearch is a server that process JSON requests and give back JSON data.</p>
<p>Elasticsearch allows you to store, search, and analyze huge volumes of data quickly and in near real-time and give back answers in milliseconds. It uses a structure based on documents instead of tables and schemas and comes with extensive REST APIs for storing and searching the data.</p>
<h1> Installation and Setting Up</h1>

<h2>Install Elasticsearch on macOS with Homebrew</h2>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% brew tap elastic&#x2F;tap</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% brew install elastic&#x2F;tap&#x2F;elasticsearch-full</span><br></pre></td></tr></table></figure>
<p>Check elasticsearch version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ elasticsearch --version </span><br><span class="line">&#x3D;&gt; (Version: 7.17.4, Build: default&#x2F;tar&#x2F;79878662c54c886ae89206c685d9f1051a9d6411&#x2F;2022-05-18T18:04:20.964345128Z, JVM: 18.0.1.1)</span><br></pre></td></tr></table></figure>
<p>Run elasticsearch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ elasticsearch</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ curl localhost:9200 # or visit http:&#x2F;&#x2F;localhost:9200&#x2F;</span><br><span class="line">&#x3D;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;Rafas-MacBook-Pro.local&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;elasticsearch_rafaltrojanowski&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;0EVLwc9hQVS2hPWnizmaqA&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.17.4&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;tar&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;79878662c54c886ae89206c685d9f1051a9d6411&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2022-05-18T18:04:20.964345128Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.11.1&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="NOTE"><a href="#NOTE" class="headerlink" title="NOTE"></a>NOTE</h6><p>There is also Elasticsearch <strong>version 8</strong>, but for this tutorial we will use version 7, because version 8 is not available via homebrew. If you want to use latest version please visit <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.14/targz.html#install-macos" target="_blank" rel="noopener">Elasticsearch</a> and install it from archive.</p>
<h2>Kibana</h2>

<p>Kibana is data visualization dashboard software for Elasticsearch. Kibana provides a user-friendly interface to interact with Elasticsearch and transform raw data into visually appealing and informative dashboards, charts, and reports. Kibana has many key features, however we will focus on using it for querying Elasticsearch and retrieving the data. You can see Kibana Dev Tools in action below (you can experiment with queries on the left, while on the right there are json responses)</p>
<p><img src="kibana-dev-tools.png" alt=""></p>
<h6 id="Install-kibana"><a href="#Install-kibana" class="headerlink" title="Install kibana"></a>Install kibana</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install elastic&#x2F;tap&#x2F;kibana-full</span><br></pre></td></tr></table></figure>

<p>Check kibana version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kibana --version </span><br><span class="line">&#x3D;&gt; 7.17.4</span><br></pre></td></tr></table></figure>

<p><strong>Note: Remember that Kibana version and Elasticsearch version must be the same.</strong></p>
<h2 id="Rails-project"><a href="#Rails-project" class="headerlink" title="Rails project"></a>Rails project</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gem install rails</span><br><span class="line">$ rails new blog --database&#x3D;postgresql</span><br><span class="line">$ cd blog</span><br></pre></td></tr></table></figure>

<p>Let’s suppose that we have <strong>Users</strong> and <strong>Articles</strong> with <strong>Comments</strong> in our database.<br>Every <em>user</em> can have many <em>articles</em>, and every <em>article</em> can have multiple <em>comments</em>.</p>
<p>To quickly generate a project structure we can use available Rails generators and Rake tasks, as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ rails g model User first_name:string last_name:string</span><br><span class="line">$ rails g scaffold Article title:string body:text user:references</span><br><span class="line">$ rails g model Comment body:text article:references</span><br><span class="line">$ rake db:create &amp;&amp; rake db:migrate</span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span> &lt; ApplicationRecord</span></span><br><span class="line">  belongs_to <span class="symbol">:user</span></span><br><span class="line">  has_many <span class="symbol">:comments</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> &lt; ApplicationRecord</span></span><br><span class="line">  has_many <span class="symbol">:articles</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> &lt; ApplicationRecord</span></span><br><span class="line">  belongs_to <span class="symbol">:article</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="Elasticsearch-integration"><a href="#Elasticsearch-integration" class="headerlink" title="Elasticsearch integration"></a>Elasticsearch integration</h3><figure class="highlight ruby"><figcaption><span>Gemfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add Elasticsearch gems</span></span><br><span class="line">gem <span class="string">'elasticsearch-model'</span></span><br><span class="line">gem <span class="string">'elasticsearch-rails'</span></span><br></pre></td></tr></table></figure>

<p>Configure Elasticsearch connection (enable logger)</p>
<figure class="highlight ruby"><figcaption><span>initializers/elasticsearch.rb</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enable Elasticsearch logger for better visibility</span></span><br><span class="line">Elasticsearch::Model.client = Elasticsearch::Client.new(</span><br><span class="line">  <span class="symbol">url:</span> ENV[<span class="string">'ELASTICSEARCH_URL'</span>] <span class="params">||</span> <span class="string">'http://localhost:9200'</span>,</span><br><span class="line">  <span class="symbol">log:</span> <span class="literal">true</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="Indexing-document"><a href="#Indexing-document" class="headerlink" title="Indexing document"></a>Indexing document</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span> &lt; ApplicationRecord</span></span><br><span class="line">  <span class="keyword">include</span> Searchable</span><br><span class="line">  <span class="comment"># (...)</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Searchable</span></span></span><br><span class="line">  extend ActiveSupport::Concern</span><br><span class="line"></span><br><span class="line">  included <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># Include to add the Elasticsearch integration for this model</span></span><br><span class="line">    <span class="comment"># (model methods such as search, mapping, import, etc)</span></span><br><span class="line">    <span class="keyword">include</span> Elasticsearch::Model </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Automatically update Elasticsearch index when the model changes</span></span><br><span class="line">    <span class="keyword">include</span> Elasticsearch::Model::Callbacks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Index Mapping</span></span><br><span class="line">    mapping <span class="keyword">do</span></span><br><span class="line">      <span class="comment"># Article fields</span></span><br><span class="line">      indexes <span class="symbol">:title</span>, <span class="symbol">type:</span> <span class="symbol">:text</span></span><br><span class="line">      indexes <span class="symbol">:body</span>, <span class="symbol">type:</span> <span class="symbol">:text</span></span><br><span class="line">      <span class="comment"># belongs_to user</span></span><br><span class="line">      indexes <span class="symbol">:user</span>, <span class="symbol">type:</span> <span class="symbol">:object</span> <span class="keyword">do</span> <span class="comment"># object type is default</span></span><br><span class="line">        indexes <span class="symbol">:first_name</span>, <span class="symbol">type:</span> <span class="symbol">:text</span></span><br><span class="line">        indexes <span class="symbol">:last_name</span>, <span class="symbol">type:</span> <span class="symbol">:text</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      <span class="comment"># has_many comments</span></span><br><span class="line">      indexes <span class="symbol">:comments</span>, <span class="symbol">type:</span> <span class="symbol">:object</span> <span class="keyword">do</span></span><br><span class="line">        indexes <span class="symbol">:body</span>, <span class="symbol">type:</span> <span class="symbol">:text</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Model JSON Serialization</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">as_indexed_json</span><span class="params">(options = &#123;&#125;)</span></span></span><br><span class="line">      as_json(</span><br><span class="line">        <span class="symbol">only:</span> [<span class="string">'title'</span>, <span class="string">'body'</span>],</span><br><span class="line">        <span class="symbol">include:</span> &#123; </span><br><span class="line">          <span class="symbol">user:</span> &#123; <span class="symbol">only:</span> [<span class="symbol">:first_name</span>, <span class="symbol">:last_name</span>] &#125;,</span><br><span class="line">          <span class="symbol">comments:</span>   &#123; <span class="symbol">only:</span> <span class="symbol">:body</span> &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">search</span><span class="params">(query)</span></span></span><br><span class="line">      <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><figcaption><span>Gemfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">group <span class="symbol">:development</span>, <span class="symbol">:test</span> <span class="keyword">do</span></span><br><span class="line">  gem <span class="string">'ffaker'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Let’s create index and seed data.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">puts <span class="string">"Performing start"</span></span><br><span class="line">Article.__elasticsearch_<span class="number">_</span>.create_index! <span class="symbol">force:</span> <span class="literal">true</span></span><br><span class="line">puts <span class="string">"Comments delete"</span> </span><br><span class="line">Comment.delete_all</span><br><span class="line">puts <span class="string">"Articles delete"</span></span><br><span class="line">Article.delete_all</span><br><span class="line">puts <span class="string">"Users delete"</span></span><br><span class="line">User.delete_all</span><br><span class="line"></span><br><span class="line">ActiveRecord::Base.connection.reset_pk_sequence!(<span class="string">'comments'</span>)</span><br><span class="line">ActiveRecord::Base.connection.reset_pk_sequence!(<span class="string">'articles'</span>)</span><br><span class="line">ActiveRecord::Base.connection.reset_pk_sequence!(<span class="string">'users'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create users</span></span><br><span class="line"><span class="number">5</span>.times <span class="keyword">do</span> <span class="params">|i|</span></span><br><span class="line">  User.create!(<span class="symbol">first_name:</span> FFaker::Name.first_name, <span class="symbol">last_name:</span> FFaker::Name.last_name)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create articles</span></span><br><span class="line">amount = <span class="number">100_000</span></span><br><span class="line">amount.times <span class="keyword">do</span> <span class="params">|i|</span></span><br><span class="line">  a = Article.create!(</span><br><span class="line">    <span class="symbol">title:</span> FFaker::Book.title, </span><br><span class="line">    <span class="symbol">body:</span> FFaker::Tweet.body,</span><br><span class="line">    <span class="symbol">user:</span> User.all.sample</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Create comments</span></span><br><span class="line">  (<span class="number">0</span>..<span class="number">3</span>).to_a.sample.times <span class="keyword">do</span></span><br><span class="line">    a.comments &lt;&lt; Comment.new(<span class="symbol">body:</span> FFaker::FreedomIpsum.paragraph)</span><br><span class="line">    a.save</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  puts i</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Article.import <span class="comment"># import all data to Elasticsearch</span></span><br><span class="line">puts <span class="string">"Performing stop"</span></span><br></pre></td></tr></table></figure>
<h2 id="Getting-documents"><a href="#Getting-documents" class="headerlink" title="Getting documents"></a>Getting documents</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.elastic.co&#x2F;guide&#x2F;en&#x2F;elasticsearch&#x2F;reference&#x2F;current&#x2F;docs-get.html#docs-get-api-request</span><br><span class="line"></span><br><span class="line">GET articles&#x2F;_doc&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;articles&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">  &quot;_version&quot; : 1,</span><br><span class="line">  &quot;_seq_no&quot; : 0,</span><br><span class="line">  &quot;_primary_term&quot; : 1,</span><br><span class="line">  &quot;found&quot; : true,</span><br><span class="line">  &quot;_source&quot; : &#123;</span><br><span class="line">    &quot;title&quot; : &quot;Bloody Monster&quot;,</span><br><span class="line">    &quot;body&quot; : &quot;Voluptate laudantium expedita commodi hic odio neque quisquam. Deleniti cupiditate mollitia animi aspernatur. Ex perferendis repudiandae.&quot;,</span><br><span class="line">    &quot;user&quot; : &#123;</span><br><span class="line">      &quot;first_name&quot; : &quot;Willis&quot;,</span><br><span class="line">      &quot;last_name&quot; : &quot;Nitzsche&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;comments&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;body&quot; : &quot;Dallas cowboys 7-Eleven MGD 18-wheeler Harley Davidson anti-metric system. Super bowl propane tanks NASA jean shorts potato salad drone strike MOPAR tomahawk cruise missile velcro. John cena juicy flame-grilled shock and awe extra beef national security monster truck rally Fox News Call of Duty Starbucks. Garth brooks Applebee&#39;s apple pie Championship Pro Bass Fishing John Cena condiments extra beef.&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Searching"><a href="#Searching" class="headerlink" title="Searching"></a>Searching</h2><h4 id="Match-all"><a href="#Match-all" class="headerlink" title="Match all"></a>Match all</h4><p>The most simple query, which matches all documents, giving them all a _score of 1.0.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET articles&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Searchable</span></span></span><br><span class="line">  included <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">match_all</span></span></span><br><span class="line">      params = &#123;</span><br><span class="line">        <span class="symbol">query:</span> &#123;</span><br><span class="line">          <span class="symbol">match_all:</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">self</span>.__elasticsearch_<span class="number">_</span>.search(params)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">query = Article.match_all</span><br><span class="line">query.results.total</span><br><span class="line">=&gt; <span class="number">10000</span></span><br><span class="line">query.results.size</span><br><span class="line">=&gt; <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h4 id="Track-total-hits"><a href="#Track-total-hits" class="headerlink" title="Track total hits"></a>Track total hits</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Searchable</span></span></span><br><span class="line">  included <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">match_all</span></span></span><br><span class="line">      params = &#123;</span><br><span class="line">        <span class="symbol">track_total_hits:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="symbol">query:</span> &#123;</span><br><span class="line">          <span class="symbol">match_all:</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">self</span>.__elasticsearch_<span class="number">_</span>.search(params)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">query = Article.match_all</span><br><span class="line">query.results.total</span><br><span class="line">=&gt; <span class="number">100000</span></span><br></pre></td></tr></table></figure>

<h5 id="Size"><a href="#Size" class="headerlink" title="Size"></a>Size</h5><p>The size parameter tells how many hits should be returned in the response.<br>Maximum value of size can be 10000, default size is 10.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Searchable</span></span></span><br><span class="line">  included <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">match_all</span></span></span><br><span class="line">      params = &#123;</span><br><span class="line">        <span class="symbol">size:</span> <span class="number">10000</span>,</span><br><span class="line">        <span class="symbol">query:</span> &#123;</span><br><span class="line">          <span class="symbol">match_all:</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">self</span>.__elasticsearch_<span class="number">_</span>.search(params)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">query = Article.match_all</span><br><span class="line">query.results.size</span><br><span class="line">=&gt; <span class="number">10000</span></span><br></pre></td></tr></table></figure>

<h3 id="Multi-match"><a href="#Multi-match" class="headerlink" title="Multi match"></a>Multi match</h3><p>The next query that we’ll explore is multi-match query. It searches across multiple fields. The ruby code responsible for building that search query is as follows:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Searchable</span></span></span><br><span class="line">  included <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">search</span><span class="params">(query)</span></span></span><br><span class="line">      params = &#123;</span><br><span class="line">        <span class="symbol">query:</span> &#123;</span><br><span class="line">          <span class="symbol">multi_match:</span> &#123;</span><br><span class="line">            <span class="symbol">query:</span> query,</span><br><span class="line">            <span class="string">"fields"</span>: [</span><br><span class="line">              <span class="string">"title"</span>, </span><br><span class="line">              <span class="string">"body"</span>, </span><br><span class="line">              <span class="string">"user.first_name"</span>, </span><br><span class="line">              <span class="string">"user.last_name"</span>, </span><br><span class="line">              <span class="string">"comments.body"</span></span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">self</span>.__elasticsearch_<span class="number">_</span>.search(params)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">query = Article.search(<span class="string">"ninjas"</span>)</span><br><span class="line">query.results.total</span><br><span class="line">=&gt; <span class="number">2668</span></span><br></pre></td></tr></table></figure>

<h3 id="Relationships"><a href="#Relationships" class="headerlink" title="Relationships"></a>Relationships</h3><p>We have a relationships within our articles index and we want to keep index up to date. So every change of comment should update coresponding artile document with that comments and every change in user should update documents with that user. Let’s dive in.</p>
<h6 id="Article-has-many-comments"><a href="#Article-has-many-comments" class="headerlink" title="Article.has_many.comments"></a>Article.has_many.comments</h6><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> &lt; ApplicationRecord</span></span><br><span class="line">  belongs_to <span class="symbol">:article</span>, <span class="symbol">touch:</span> <span class="literal">true</span> <span class="comment"># add touch: true </span></span><br><span class="line">  <span class="comment"># associated object will be touched (the updated_at / updated_on attributes set to current time) when this record is either saved or destroyed. </span></span><br><span class="line">  <span class="comment"># (...)</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h6 id="Article-belongs-to-user"><a href="#Article-belongs-to-user" class="headerlink" title="Article.belongs_to.user"></a>Article.belongs_to.user</h6><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> &lt; ApplicationRecord</span></span><br><span class="line">  after_update &#123; <span class="keyword">self</span>.articles.find_each(&amp;<span class="symbol">:touch</span>) &#125; <span class="comment"># add after_update callback</span></span><br><span class="line">  <span class="comment"># (...)</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="Querying"><a href="#Querying" class="headerlink" title="Querying"></a>Querying</h3><p>Note: </p>
<ol>
<li><p>Match all query returns only 10 results. We can change it by passing <code>size</code> in a query and increase result window.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Searchable</span></span></span><br><span class="line">  included <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">match_all</span></span></span><br><span class="line">      params = &#123;</span><br><span class="line">        <span class="symbol">size:</span> <span class="number">10000</span> <span class="comment"># this is maximum value for size parameter</span></span><br><span class="line">        <span class="symbol">query:</span> &#123;</span><br><span class="line">          <span class="symbol">match_all:</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">self</span>.__elasticsearch_<span class="number">_</span>.search(params)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>hits total value says that there is 10000 hits even in a database we have 100k records.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Searchable</span></span></span><br><span class="line">  included <span class="keyword">do</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">match_all</span></span></span><br><span class="line">      params = &#123;</span><br><span class="line">        <span class="symbol">track_total_hits:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="symbol">query:</span> &#123;</span><br><span class="line">          <span class="symbol">match_all:</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">self</span>.__elasticsearch_<span class="number">_</span>.search(params)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ query = Article.match_all</span><br><span class="line"></span><br><span class="line">$ query.results.total</span><br><span class="line"></span><br><span class="line">=&gt; <span class="number">100000</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<h1 id="Pagination"><a href="#Pagination" class="headerlink" title="Pagination"></a>Pagination</h1><h2 id="kaminari"><a href="#kaminari" class="headerlink" title="kaminari"></a>kaminari</h2><figure class="highlight ruby"><figcaption><span>Gemfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem <span class="string">'kaminari'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticlesController</span> &lt; ApplicationController</span></span><br><span class="line">  <span class="comment"># GET /articles </span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></span><br><span class="line">    @articles = Article.match_all.page(params[<span class="symbol">:page</span>]).records</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="comment">#...</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;p style=<span class="string">"color: green"</span>&gt;&lt;%= notice %&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;h1&gt;Articles&lt;/h</span>1&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=<span class="string">"articles"</span>&gt;</span><br><span class="line">  &lt;% @articles.each <span class="keyword">do</span> <span class="params">|article|</span> %&gt;</span><br><span class="line">    &lt;%= render article %&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;%= link_to <span class="string">"Show this article"</span>, article %&gt;</span><br><span class="line">    &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;% end %&gt;</span></span><br><span class="line"><span class="regexp">&lt;/div</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;%= link_to <span class="string">"New article"</span>, new_article_path %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%= paginate @articles %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="will-paginate"><a href="#will-paginate" class="headerlink" title="will_paginate"></a>will_paginate</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem <span class="string">'will_paginate'</span>, <span class="string">'~&gt; 4.0'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticlesController</span> &lt; ApplicationController</span></span><br><span class="line">  <span class="comment"># GET /articles or /articles.json</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></span><br><span class="line">    @articles = Article.match_all.paginate(<span class="symbol">page:</span> params[<span class="symbol">:page</span>]).records</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;p style=<span class="string">"color: green"</span>&gt;&lt;%= notice %&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;h1&gt;Articles&lt;/h</span>1&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=<span class="string">"articles"</span>&gt;</span><br><span class="line">  &lt;% @articles.each <span class="keyword">do</span> <span class="params">|article|</span> %&gt;</span><br><span class="line">    &lt;%= render article %&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;%= link_to <span class="string">"Show this article"</span>, article %&gt;</span><br><span class="line">    &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;% end %&gt;</span></span><br><span class="line"><span class="regexp">&lt;/div</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;%= link_to <span class="string">"New article"</span>, new_article_path %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%= will_paginate @articles %&gt;</span><br></pre></td></tr></table></figure>


<h1 id="URI-search-query-simple-search-query"><a href="#URI-search-query-simple-search-query" class="headerlink" title="URI search query (simple search query)"></a>URI search query (simple search query)</h1><h4 id="Simple-query"><a href="#Simple-query" class="headerlink" title="Simple query:"></a>Simple query:</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">query = Article.__elasticsearch_<span class="number">_</span>.search(<span class="string">"Season of the Champagne Ninjas"</span>, <span class="symbol">track_total_hits:</span> <span class="literal">true</span>, <span class="symbol">size:</span> <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># GET articles/_search?q=Season+of+the+Champagne+Ninjas</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     "track_total_hits": true,</span></span><br><span class="line"><span class="comment">#     "size": 20</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GET articles/_search?q=Season+of+the+Champagne+Ninjas&amp;size=20&amp;track_total_hits=true</span></span><br><span class="line"></span><br><span class="line">query.results.total</span><br><span class="line">=&gt; <span class="number">80788</span></span><br></pre></td></tr></table></figure>

<h4 id="Exact-match-notice-double-quotes-escaped-in-search-query"><a href="#Exact-match-notice-double-quotes-escaped-in-search-query" class="headerlink" title="Exact match (notice double quotes escaped in search query):"></a>Exact match (notice double quotes escaped in search query):</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET articles/_search?q="Season of the Champagne Ninjas"</span></span><br><span class="line">query = Article.__elasticsearch_<span class="number">_</span>.search(<span class="string">"\"Season of the Champagne Ninjas\""</span>)</span><br><span class="line"></span><br><span class="line">query.results.total</span><br><span class="line">=&gt; <span class="number">5</span></span><br></pre></td></tr></table></figure>

<h4 id="Specified-field"><a href="#Specified-field" class="headerlink" title="Specified field"></a>Specified field</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET articles/_search?q=title:"Season of the Champagne Ninja</span></span><br><span class="line">query = Article.__elasticsearch_<span class="number">_</span>.search(<span class="string">"title:Champagne Ninjas"</span>)</span><br><span class="line"></span><br><span class="line">query.results.total</span><br><span class="line">=&gt; <span class="number">7511</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GET articles/_search?q=body:"Season of the Champagne Ninjas</span></span><br><span class="line"></span><br><span class="line">query = Article.__elasticsearch_<span class="number">_</span>.search(<span class="string">"body:Champagne Ninjas"</span>)</span><br><span class="line"></span><br><span class="line">query.results.total</span><br><span class="line">=&gt; <span class="number">2668</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GET articles/_search?q=body:Hubert</span></span><br><span class="line">$ user_first_name = User.first.first_name</span><br><span class="line">query = Article.__elasticsearch_<span class="number">_</span>.search(<span class="string">"body:<span class="subst">#&#123;user_first_name&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">$ query.records.total</span><br><span class="line">=&gt; <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>Source:<br>(<a href="https://gist.github.com/amulyakashyap09/e8442735fe576145dfbed809bb089056#simple-search-query" target="_blank" rel="noopener">https://gist.github.com/amulyakashyap09/e8442735fe576145dfbed809bb089056#simple-search-query</a>) </p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2021/01/09/how-to-build-nested-form-ala-rails-with-phoenix-liveview/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a></div><div class="fb-comments-area"><div class="fb-comments" data-href="http://rafaltrojanowski.github.io/2024/06/20/full-text-search-with-elasticsearch-in-rails/" data-width="700" data-numposts="5"></div></div><div class="copyright"><p>© 2012 - 2024 <a href="https://github.com/stunstunstun" target="_blank">Rafał Trojanowski</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div><script>window.fbAsyncInit=function(){FB.init({appId:"1279423065775877",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-112438069-1','auto');ga('send','pageview');</script></body></html>